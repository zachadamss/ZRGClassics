---
layout: layouts/base.njk
title: Create Account
description: Join the ZRG Classics community. Create an account to participate in forums and connect with other enthusiasts.
---

<main class="auth-page">
  <div class="auth-container">
    <div class="auth-card">
      <h1>Join ZRG Classics</h1>
      <p class="auth-subtitle">Create your free account</p>

      <form id="register-form" class="auth-form">
        <div class="form-group">
          <label for="username">Username</label>
          <input type="text" id="username" name="username" required autocomplete="username"
                 pattern="[a-zA-Z0-9_]+" minlength="3" maxlength="20"
                 title="Letters, numbers, and underscores only">
          <small class="form-hint">3-20 characters, letters, numbers, and underscores only</small>
        </div>

        <div class="form-group">
          <label for="email">Email</label>
          <input type="email" id="email" name="email" required autocomplete="email">
        </div>

        <div class="form-group">
          <label for="password">Password</label>
          <input type="password" id="password" name="password" required autocomplete="new-password" minlength="8">
          <small class="form-hint">Minimum 8 characters</small>
        </div>

        <div class="form-group">
          <label for="confirm-password">Confirm Password</label>
          <input type="password" id="confirm-password" name="confirm-password" required autocomplete="new-password">
        </div>

        <div class="form-group form-checkbox">
          <label>
            <input type="checkbox" id="newsletter-optin" name="newsletter-optin" checked>
            <span>Subscribe to the ZRG Classics newsletter for restoration tips, guides, and project updates</span>
          </label>
        </div>

        <button type="submit" class="btn btn-primary btn-block">Create Account</button>
      </form>

      <div class="auth-links">
        <span>Already have an account?</span>
        <a href="/account/login/">Sign in</a>
      </div>
    </div>
  </div>
</main>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script src="/js/supabase.js"></script>
<script>
// TODO: Replace with your actual ConvertKit credentials
const CONVERTKIT_FORM_ID = 'YOUR_CONVERTKIT_FORM_ID';
const CONVERTKIT_API_KEY = 'YOUR_CONVERTKIT_API_KEY';

document.addEventListener('DOMContentLoaded', async () => {
  // Check if already logged in
  const user = await Auth.getUser();
  if (user) {
    window.location.href = '/account/garage/';
    return;
  }

  // Pre-fill email if passed from homepage newsletter signup
  const params = new URLSearchParams(window.location.search);
  const prefillEmail = params.get('email');
  if (prefillEmail) {
    document.getElementById('email').value = prefillEmail;
  }

  const form = document.getElementById('register-form');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const username = document.getElementById('username').value.trim();
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    const confirmPassword = document.getElementById('confirm-password').value;
    const newsletterOptIn = document.getElementById('newsletter-optin').checked;
    const submitBtn = form.querySelector('button[type="submit"]');

    // Validate passwords match
    if (password !== confirmPassword) {
      AuthUI.showError(form, 'Passwords do not match');
      return;
    }

    submitBtn.disabled = true;
    submitBtn.textContent = 'Creating account...';

    try {
      await Auth.signUp(email, password, username);

      // Fire-and-forget newsletter subscription
      if (newsletterOptIn) {
        fetch(`https://api.convertkit.com/v3/forms/${CONVERTKIT_FORM_ID}/subscribe`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            api_key: CONVERTKIT_API_KEY,
            email: email,
            first_name: username
          })
        }).catch(err => console.warn('Newsletter signup failed (non-blocking):', err));
      }

      // Show success message
      form.innerHTML = `
        <div class="alert alert-success">
          <h3>Check your email</h3>
          <p>We've sent a confirmation link to <strong>${email}</strong>.</p>
          <p>Click the link in the email to activate your account.</p>
        </div>
        <a href="/account/login/" class="btn btn-secondary btn-block">Back to Sign In</a>
      `;
    } catch (error) {
      AuthUI.showError(form, error.message);
      submitBtn.disabled = false;
      submitBtn.textContent = 'Create Account';
    }
  });
});
</script>
